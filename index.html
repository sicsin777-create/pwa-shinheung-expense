<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b3d91" />

  <title>ì‹ í¥ì¤‘ ì•¼êµ¬ë¶€ ê°€ê³„ë¶€</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />

  <style>
    /* ======================================
       í°íŠ¸ & ìƒ‰ìƒ ê¸°ë³¸ê°’
    ====================================== */
    :root {
      --blue: #0b3d91;
      --blue-light: #1f5dd1;
      --bg: #f2f5fa;
      --text: #333;
      font-family: 'Noto Sans KR', sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    /* ======================================
       ìƒë‹¨ í—¤ë”
    ====================================== */
    .header {
      background: linear-gradient(135deg, var(--blue), var(--blue-light));
      color: #fff;
      padding: 40px 20px 60px 20px;
      border-radius: 0 0 25px 25px;
    }

    .header-title {
      font-size: 30px;
      font-weight: 900;
    }

    /* ======================================
       ì˜ˆì‚° ì¹´ë“œ ì˜ì—­
    ====================================== */
    .card-container {
      margin-top: -40px;
      padding: 0 15px;
      display: flex;
      gap: 12px;
    }

    .card {
      background: white;
      padding: 18px;
      border-radius: 16px;
      flex: 1;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    .card-title {
      font-size: 14px;
      color: #777;
    }
    .card-value {
      font-size: 22px;
      font-weight: 700;
      margin-top: 5px;
      color: var(--blue);
    }

    /* ======================================
       ì§€ì¶œ ëª©ë¡
    ====================================== */
    .section-title {
      margin: 25px 15px 10px 15px;
      font-size: 20px;
      font-weight: 700;
    }

    .expense-item {
      background: #fff;
      margin: 10px 15px;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .expense-top {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
    }
    .expense-memo {
      color: #666;
      margin-top: 6px;
    }

    /* ======================================
       í”Œë¡œíŒ… ë²„íŠ¼ (ì§€ì¶œ ì¶”ê°€)
    ====================================== */
    .fab {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 65px;
      height: 65px;
      border-radius: 50%;
      background: var(--blue);
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 35px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      user-select: none;
    }

    /* ======================================
       ğŸ“Œ ëª¨ë‹¬ ì „ì²´ UI ê°œì„  (í‚¤ë³´ë“œ ëŒ€ì‘ í¬í•¨)
    ====================================== */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.45);
      display: none;
      justify-content: center;
      align-items: flex-end;
      z-index: 999;
    }
    .modal.show {
      display: flex;
    }

    .modal-content {
      width: 100%;
      max-height: 85vh;
      background: white;
      border-radius: 20px 20px 0 0;
      padding: 20px;
      overflow-y: auto;
      animation: slideUp .25s ease-out;
    }

    @keyframes slideUp {
      from { opacity:0; transform: translateY(50px);} 
      to   { opacity:1; transform: translateY(0);}
    }

    .modal-drag {
      width: 70px; height: 6px;
      background:#ccc;
      border-radius:3px;
      margin:0 auto 15px auto;
    }

    .modal-content input,
    .modal-content select,
    .modal-content textarea {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 16px;
      box-sizing: border-box;
    }

    .modal-content label {
      margin-top: 15px;
      display: block;
      font-weight: 700;
    }

    #saveBtn {
      width: 100%;
      padding: 15px;
      border-radius: 12px;
      background: var(--blue);
      color: white;
      font-size: 18px;
      border: none;
      margin-top: 20px;
      font-weight: 700;
    }
  </style>
</head>

<body>

  <!-- =======================
       ìƒë‹¨ í—¤ë”
  ======================== -->
  <div class="header">
    <div class="header-title">ì‹ í¥ì¤‘ ì•¼êµ¬ë¶€</div>
    <div>ì§‘í–‰ë¶€ ì „ìš© ê°€ê³„ë¶€</div>

    <div style="margin-top: 20px; font-size:18px; font-weight:700;">
      ì˜ˆì‚° ì›”  
      <select id="budgetMonth" onchange="refreshDashboard()" style="
        padding:8px; border-radius:10px; font-size:16px;">
      </select>
    </div>
  </div>

  <!-- =======================
       ì˜ˆì‚° ì¹´ë“œ
  ======================== -->
  <div class="card-container">
    <div class="card">
      <div class="card-title">ì´ë²ˆë‹¬ ì˜ˆì‚°</div>
      <div class="card-value" id="budgetTotal">â‚©0</div>
    </div>

    <div class="card">
      <div class="card-title">ì§€ì¶œ í•©ê³„</div>
      <div class="card-value" id="expenseTotal">â‚©0</div>
    </div>

    <div class="card">
      <div class="card-title">ë‚¨ì€ ì˜ˆì‚°</div>
      <div class="card-value" id="budgetRemain">â‚©0</div>
    </div>
  </div>

  <!-- =======================
       ì§€ì¶œ ëª©ë¡
  ======================== -->
  <div class="section-title">ì§€ì¶œ ë‚´ì—­</div>
  <div id="expenseList"></div>

  <!-- í”Œë¡œíŒ… ë²„íŠ¼ -->
  <div class="fab" onclick="openModal()">ï¼‹</div>

  <!-- =======================
       ğŸ“Œ ì§€ì¶œ ë“±ë¡ ëª¨ë‹¬
  ======================== -->
  <div id="expenseModal" class="modal">
    <div class="modal-content">
      <div class="modal-drag"></div>

      <h2>ì§€ì¶œ ë“±ë¡</h2>

      <label>ë“±ë¡ì</label>
      <input id="inputName" placeholder="ì˜ˆ: ì´ìŠ¹í˜„" />

      <label>ì§€ì¶œì¼</label>
      <input id="inputDate" type="date" />

      <label>ì¹´í…Œê³ ë¦¬</label>
      <select id="inputCategory">
        <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
        <option>ì‹ë¹„</option>
        <option>ìš©í’ˆ</option>
        <option>ëŒ€íšŒë¹„</option>
        <option>ìœ ë¥˜ë¹„</option>
        <option>ê¸°íƒ€</option>
      </select>

      <label>ì˜ˆì‚°ì›”</label>
      <input id="inputBudget" type="month" />

      <label>ê¸ˆì•¡</label>
      <input id="inputAmount" type="number" inputmode="numeric" placeholder="â‚©" />

      <label>ë‚´ìš©</label>
      <textarea id="inputMemo" rows="4" placeholder="ë¬´ìŠ¨ ìš©ë„ì˜€ëŠ”ì§€ ì ì–´ì£¼ì„¸ìš”"></textarea>

      <button id="saveBtn" onclick="saveExpense()">ì €ì¥í•˜ê¸°</button>

    </div>
  </div>

  <!-- =======================
       JS - ì¤‘ì‹¬ ë¡œì§
  ======================== -->
  <script>
    let expenses = [];

    // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    function openModal() {
      document.getElementById("expenseModal").classList.add("show");
    }
    function closeModal() {
      document.getElementById("expenseModal").classList.remove("show");
    }

    // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = (e) => {
      if (e.target.classList.contains("modal")) closeModal();
    };

    // ì˜ˆì‚° ì›” ë“œë¡­ë‹¤ìš´
    function initBudgetMonth() {
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, "0");

      document.getElementById("budgetMonth").innerHTML = `
        <option value="${yyyy}-${mm}">${yyyy}/${mm}</option>
      `;
    }

    // ì €ì¥
    function saveExpense() {
      const item = {
        name: inputName.value,
        date: inputDate.value,
        category: inputCategory.value,
        budget: inputBudget.value,
        amount: Number(inputAmount.value),
        memo: inputMemo.value,
      };

      expenses.push(item);
      closeModal();
      renderExpenses();
      refreshDashboard();
    }

    // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
    function refreshDashboard() {
      let month = document.getElementById("budgetMonth").value;

      let filtered = expenses.filter(x => x.budget === month);
      let total = filtered.reduce((sum, x) => sum + x.amount, 0);

      document.getElementById("budgetTotal").textContent = "â‚©0";  // í•„ìš”í•˜ë©´ ì—°ë™
      document.getElementById("expenseTotal").textContent = "â‚©" + total.toLocaleString();
      document.getElementById("budgetRemain").textContent = "â‚©" + (0 - total).toLocaleString();
    }

    // ì§€ì¶œ ëª©ë¡
    function renderExpenses() {
      let html = "";
      for (let x of expenses) {
        html += `
          <div class="expense-item">
            <div class="expense-top">
              <div>${x.category}</div>
              <div>â‚©${x.amount.toLocaleString()}</div>
            </div>
            <div class="expense-memo">${x.memo}</div>
          </div>
        `;
      }
      document.getElementById("expenseList").innerHTML = html;
    }

    // ì´ˆê¸°í™”
    initBudgetMonth();
  </script>

  <!-- PWA ë“±ë¡ -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

</body>
</html>
